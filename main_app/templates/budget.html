{% extends 'base.html' %}
{% load static %}

{% block title %}My Budget - BaytDesign{% endblock %}

{% block content %}
<div class="container py-4">
    <h1>My Budget</h1>
    {% if budget_created_at %}
        <small>Created on: {{ budget_created_at|date:"F j, Y" }}</small>
    {% endif %}

    <p>Total Budget: ${{ budget.total|floatformat:2 }}</p>
    <p>Total Spent: ${{ total_spent|floatformat:2 }}</p>
    <p>Remaining: ${{ remaining_budget|floatformat:2 }}</p>

    <!-- Progress Bar -->
    <div class="progress mb-3" style="height:20px;">
        <div class="progress-bar" style="width: {{ budget_percentage|default:0|floatformat:0 }}%;"></div>
    </div>
    <small>{{ budget_percentage|default:0|floatformat:0 }}% used</small>

    <!-- Update Budget Form -->
    <form method="post" class="mb-4 mt-3">
        {% csrf_token %}
        <label>Update Budget ($)</label>
        <input type="number" name="budget" value="{{ budget.total }}" min="0" step="0.01" class="form-control mb-2">
        <button type="submit" class="btn btn-primary">Update</button>
    </form>

    <!-- Selected Products -->
    <h3>Selected Products</h3>
    {% if selected_products %}
        <ul>
        {% for sp in selected_products %}
            <li>{{ sp.product.name }} - ${{ sp.product.price|floatformat:2 }} Ã— {{ sp.quantity }} = ${{ sp.total_price|floatformat:2 }}</li>
        {% endfor %}
        </ul>
        <p><strong>Total Spent:</strong> ${{ total_spent|floatformat:2 }}</p>
    {% else %}
        <p>No products selected. <a href="{% url 'home' %}">Browse Categories</a></p>
    {% endif %}
</div>
{% endblock %}